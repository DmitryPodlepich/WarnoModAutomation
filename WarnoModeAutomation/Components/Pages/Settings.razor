@page "/settings"
@using BlazorBootstrap
@using System.Diagnostics
@using WarnoModeAutomation.Components.Components
@using WarnoModeAutomation.Constants
@using WarnoModeAutomation.Logic
@using JsonDatabase.DTO

<section class="p-3">

    <h4 class="fw-bold">Warno mod settings</h4>

    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text" id="inputGroup-sizing-default">Warno modes directory:</span>
        </div>
        <input @bind="Storage.ModeSettings.ModsDirectory" type="text" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default">
    </div>

    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text" id="inputGroup-sizing-default">Mode name:</span>
        </div>
        <input @bind="Storage.ModeSettings.ModName" type="text" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default">
    </div>

    <h5 class="text-center">
        Balance settings <i style="font-size: 18px !important;" class="bi bi-bar-chart fs-3 text-primary"></i>
    </h5>
    <hr />

    <ModSettingSection PropertyName="@nameof(_settingsDTO.WarnoMetters)" TValue="int" @bind-PropertyValue="_settingsDTO.WarnoMetters">
        <p class="text-muted">
            The constant value which determinants distance measuring. Has been defined experimental way when we took value from UI and from resource files and compare it. 
            Strongly recommended to leave as is.
        </p>
    </ModSettingSection>

    <ModSettingSection PropertyName="@nameof(_settingsDTO.NerfDistanceCoefficientDivider)" TValue="int" @bind-PropertyValue="_settingsDTO.NerfDistanceCoefficientDivider">
        <p class="text-muted">
            There is a special formula which will update distance value. The more is a difference between original and new distance value the more this new value will be reduced in order to save game balance.
            The more this value the more new distance value will be reduced.
        </p>
    </ModSettingSection>

@*     <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.NerfDistanceCoefficientDivider):</span>
        <input class="form-control" @bind="_settingsDTO.NerfDistanceCoefficientDivider" placeholder="Enter NerfDistanceCoefficientDivider" />
    </div> *@

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.AdditionalPointsCoefficientMultiplier):</span>
        <input class="form-control" @bind="_settingsDTO.AdditionalPointsCoefficientMultiplier" placeholder="Enter AdditionalPointsCoefficientMultiplier" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.AdditionalPointsArtileryCoefficientDivider):</span>
        <input class="form-control" @bind="_settingsDTO.AdditionalPointsArtileryCoefficientDivider" placeholder="Enter AdditionalPointsArtileryCoefficientDivider" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.NatoCommonAccuracityBonusPercentage):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.NatoCommonAccuracityBonusPercentage" Placeholder="Enter NatoCommonAccuracityBonusPercentage" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.NatoArtileryAccuracityBonusPercentage):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.NatoArtileryAccuracityBonusPercentage" Placeholder="Enter NatoArtileryAccuracityBonusPercentage" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.SovMinOpticalStrength):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.SovMinOpticalStrength" Placeholder="Enter SovMinOpticalStrength" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.NatoMinOpticalStrength):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.NatoMinOpticalStrength" Placeholder="Enter NatoMinOpticalStrength" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.SovGroundVisionPercentageFromAmunitionDistance):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.SovGroundVisionPercentageFromAmunitionDistance" Placeholder="Enter SovGroundVisionPercentageFromAmunitionDistance" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.NatoGroundVisionPercentageFromAmunitionDistance):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.NatoGroundVisionPercentageFromAmunitionDistance" Placeholder="Enter NatoGroundVisionPercentageFromAmunitionDistance" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.SovTBAVisionPercentageFromAmunitionDistance):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.SovTBAVisionPercentageFromAmunitionDistance" Placeholder="Enter SovTBAVisionPercentageFromAmunitionDistance" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.NatoTBAVisionPercentageFromAmunitionDistance):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.NatoTBAVisionPercentageFromAmunitionDistance" Placeholder="Enter amoNatoTBAVisionPercentageFromAmunitionDistanceunt" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.SovHAVisionPercentageFromAmunitionDistance):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.SovHAVisionPercentageFromAmunitionDistance" Placeholder="Enter SovHAVisionPercentageFromAmunitionDistance" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.NatoHAVisionPercentageFromAmunitionDistance):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.NatoHAVisionPercentageFromAmunitionDistance" Placeholder="Enter NatoHAVisionPercentageFromAmunitionDistance" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.SovMinVisionDistance):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.SovMinVisionDistance" Placeholder="Enter SovMinVisionDistance" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.NatoMinVisionDistance):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.NatoMinVisionDistance" Placeholder="Enter NatoMinVisionDistance" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.TBAAndHADetectionPercentageFromVisionDistance):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.TBAAndHADetectionPercentageFromVisionDistance" Placeholder="Enter TBAAndHADetectionPercentageFromVisionDistance" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.GroudDetectionPercentageFromVisionDistance):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.GroudDetectionPercentageFromVisionDistance" Placeholder="Enter GroudDetectionPercentageFromVisionDistance" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.ArtileryDamagePercentage):</span>
        <NumberInput Class="form-control" TValue="int" @bind-Value="_settingsDTO.ArtileryDamagePercentage" Placeholder="Enter ArtileryDamagePercentage" />
    </div>

    <h5 class="text-center">Serialization settings <i style="font-size: 18px !important;" class="bi bi-bounding-box fs-3 text-primary"></i></h5>
    <hr />

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.ConfigFileName):</span>
        <input class="form-control" @bind="_settingsDTO.ConfigFileName" Placeholder="Enter ConfigFileName" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.BuildingDescriptorsFileName):</span>
        <input class="form-control" @bind="_settingsDTO.BuildingDescriptorsFileName" Placeholder="Enter BuildingDescriptorsFileName" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.UniteDescriptorFileName):</span>
        <input class="form-control" @bind="_settingsDTO.UniteDescriptorFileName" Placeholder="Enter UniteDescriptorFileName" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.WeaponDescriptorDescriptorsFileName):</span>
        <input class="form-control" @bind="_settingsDTO.WeaponDescriptorDescriptorsFileName" Placeholder="Enter WeaponDescriptorDescriptorsFileName" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.AmmunitionDescriptorsFileName):</span>
        <input class="form-control" @bind="_settingsDTO.AmmunitionDescriptorsFileName" Placeholder="Enter AmmunitionDescriptorsFileName" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.AmmunitionMissilesDescriptorsFileName):</span>
        <input class="form-control" @bind="_settingsDTO.AmmunitionMissilesDescriptorsFileName" Placeholder="Enter AmmunitionMissilesDescriptorsFileName" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.ResourceCommandPoints):</span>
        <input class="form-control" @bind="_settingsDTO.ResourceCommandPoints" Placeholder="Enter ResourceCommandPoints" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.AmunitionNameSMOKEMarker):</span>
        <input class="form-control" @bind="_settingsDTO.AmunitionNameSMOKEMarker" Placeholder="Enter AmunitionNameSMOKEMarker" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.InfanterieTag):</span>
        <input class="form-control" @bind="_settingsDTO.InfanterieTag" Placeholder="Enter InfanterieTag" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.Canon_AA_StandardTag):</span>
        <input class="form-control" @bind="_settingsDTO.Canon_AA_StandardTag" Placeholder="Enter Canon_AA_StandardTag" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.Canon_AATag):</span>
        <input class="form-control" @bind="_settingsDTO.Canon_AATag" Placeholder="Enter Canon_AATag" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.AirTag):</span>
        <input class="form-control" @bind="_settingsDTO.AirTag" Placeholder="Enter AirTag" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.Weapon_Cursor_MachineGun):</span>
        <input class="form-control" @bind="_settingsDTO.Weapon_Cursor_MachineGun" Placeholder="Enter Weapon_Cursor_MachineGun" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.ArtillerieTag):</span>
        <input class="form-control" @bind="_settingsDTO.ArtillerieTag" Placeholder="Enter ArtillerieTag" />
    </div>

    <div class="mb-3 d-flex align-items-center">
        <span class="input-group-text">@nameof(_settingsDTO.ArtileryWeaponCursorType):</span>
        <input class="form-control" @bind="_settingsDTO.ArtileryWeaponCursorType" Placeholder="Enter ArtileryWeaponCursorType" />
    </div>

    <div class="d-flex justify-content-end">

        <Button Loading="@(_currentOperation == OperationType.Save)" LoadingText="Saving..." Disabled="@(_currentOperation != OperationType.Idle)" Class="btn btn-primary me-3" @onclick="Save">
            <i class="bi bi-save"></i>
            Save
        </Button>

        <Button Loading="@(_currentOperation == OperationType.RestoreDefaults)" LoadingText="Restoring defaults..." Disabled="@(_currentOperation != OperationType.Idle)" Class="btn btn-danger" @onclick="RestoreDefaults">
            <i class="bi bi-body-text"></i>
            Restore defaults
        </Button>

    </div>

</section>
@code
{
    private enum OperationType
    {
        Idle,
        Save,
        RestoreDefaults
    }

    private OperationType _currentOperation;

    private SettingsDTO _settingsDTO = JsonDatabase.JsonDatabase.LoadSettings();

    private async Task Save()
    {
        _currentOperation = OperationType.Save;

        await JsonDatabase.JsonDatabase.SaveSettings(_settingsDTO);

        _settingsDTO = JsonDatabase.JsonDatabase.LoadSettings();

        ModManager.LoadSettings();

        _currentOperation = OperationType.Idle;
    }

    private void RestoreDefaults() 
    {
        _currentOperation = OperationType.RestoreDefaults;

        _settingsDTO = new SettingsDTO(
            Storage.ModeSettings.ModsDirectory,
            Storage.ModeSettings.ModName,
            WarnoConstants.WarnoMetters,
            WarnoConstants.NerfDistanceCoefficientDivider,
            WarnoConstants.AdditionalPointsCoefficientMultiplier,
            WarnoConstants.AdditionalPointsArtileryCoefficientDivider,
            WarnoConstants.NatoCommonAccuracityBonusPercentage,
            WarnoConstants.NatoArtileryAccuracityBonusPercentage,
            WarnoConstants.SovMinOpticalStrength,
            WarnoConstants.NatoMinOpticalStrength,
            WarnoConstants.SovGroundVisionPercentageFromAmunitionDistance,
            WarnoConstants.NatoGroundVisionPercentageFromAmunitionDistance,
            WarnoConstants.SovTBAVisionPercentageFromAmunitionDistance,
            WarnoConstants.NatoTBAVisionPercentageFromAmunitionDistance,
            WarnoConstants.SovHAVisionPercentageFromAmunitionDistance,
            WarnoConstants.NatoHAVisionPercentageFromAmunitionDistance,
            WarnoConstants.SovMinVisionDistance,
            WarnoConstants.NatoMinVisionDistance,
            WarnoConstants.TBAAndHADetectionPercentageFromVisionDistance,
            WarnoConstants.GroudDetectionPercentageFromVisionDistance,
            WarnoConstants.ArtileryDamagePercentage,
            WarnoConstants.ConfigFileName,
            WarnoConstants.BuildingDescriptorsFileName,
            WarnoConstants.UniteDescriptorFileName,
            WarnoConstants.WeaponDescriptorDescriptorsFileName,
            WarnoConstants.AmmunitionDescriptorsFileName,
            WarnoConstants.AmmunitionMissilesDescriptorsFileName,
            WarnoConstants.ResourceCommandPoints,
            WarnoConstants.AmunitionNameSMOKEMarker,
            WarnoConstants.InfanterieTag,
            WarnoConstants.Canon_AA_StandardTag,
            WarnoConstants.Canon_AATag,
            WarnoConstants.AirTag,
            WarnoConstants.Weapon_Cursor_MachineGun,
            WarnoConstants.ArtillerieTag,
            WarnoConstants.ArtileryWeaponCursorType
        );

        _currentOperation = OperationType.Idle;
    }
}